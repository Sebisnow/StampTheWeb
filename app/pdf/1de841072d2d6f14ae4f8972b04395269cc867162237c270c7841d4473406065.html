<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<h1>BM Corser - Merkle DAG</h1><html><body><div><div class="document" id="merkle-dag">
<h1 class="title">Merkle DAG</h1>

<p>Not invented by the German chancellor, but interesting nonetheless.</p>
<p>The nuance of the naming might not stick the first time; there is <a class="reference external" href="athttps://github.com/jbenet/random-ideas/issues/20">a
distinction</a> between a Merkle <strong>tree</strong> <a class="reference external" href="http://www.bittorrent.org/beps/bep_0030.html">typically used</a> to incrementally
verify data integrity and a Merkle <strong>DAG</strong> as used by Git. The key difference
between the two structures is that (in the more-general DAG one) any node can
potentially hold data and references as well as a hash of its parents.</p>
<p>This is true of the graph of objects making up the the “main” DAG in everyone’s
Git repos, except that <a class="reference external" href="http://giphy.com/gifs/cartoon-network-flying-superman-Uw0Xv5ZKasc0g/fullscreen">as far as my understanding goes</a> Git’s Merkle DAG is
used more for high performance addressing and perhaps deduplication rather than
ensuring data integrity between peers.</p>
<div class="section" id="merkle-tree">
<h1>Merkle tree</h1>
<p>Let’s look at how a binary Merkle tree is used in peer-to-peer systems to allow
verification of untrusted data with a high degree of confidence and low
metadata overhead.</p>
<p>To be able to verify the hash of a block I have, I need a trusted root hash (a
trusted hash of all blocks) and a series of hashes that can be used to
reconstruct the hash tree for the blocks I don’t have. Because the hashes are
in a tree structure, this doesn’t necessarily mean the hashes of <em>all</em> the
missing blocks (although that would work too).</p>
<p>In the example below, we have been sent block <tt class="docutils literal">B9</tt> (red) and the required
“uncle” hashes (blue) by an untrusted peer. We don’t have any other verified
blocks (yellow) and we need to verify the integrity of the block we’ve been
sent. To do this we don’t need anything apart from the hash of the untrusted
block (23), the untrusted “uncle” hashes and the trusted root hash (green).
Calculating the missing nodes in the Merkle tree (pink) by hashing the
descendants will eventually yield an untrusted hash representing all the
blocks. This <em>untrusted</em> root hash can then be compared to our <em>trusted</em> root
hash to decide whether to keep the block or not (and treat that peer as
untrustworthy in the future, etc).</p>





<svg class="dot-graph" viewbox="0.00 0.00 1142.00 476.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 472)">
<title>merkle</title>
<polygon fill="white" points="-4,4 -4,-472 1138,-472 1138,4 -4,4" stroke="none"/>

<g class="node" id="node1"><title>1</title>
<ellipse cx="711" cy="-162" fill="#7fdbff" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="711" y="-157.8">1</text>
</g>

<g class="node" id="node33"><title>0</title>
<ellipse cx="567" cy="-90" fill="pink" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="567" y="-85.8">0</text>
</g>

<g class="edge" id="edge5"><title>1-&gt;0</title>
<path d="M689.752,-150.671C665.398,-138.832 625.281,-119.331 597.572,-105.862" fill="none" stroke="black"/>
<polygon fill="black" points="598.859,-102.595 588.335,-101.371 595.798,-108.891 598.859,-102.595" stroke="black"/>
</g>

<g class="node" id="node2"><title>12</title>
<ellipse cx="387" cy="-306" fill="#7fdbff" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="387" y="-301.8">12</text>
</g>

<g class="node" id="node31"><title>5</title>
<ellipse cx="423" cy="-234" fill="pink" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="423" y="-229.8">5</text>
</g>

<g class="edge" id="edge35"><title>12-&gt;5</title>
<path d="M395.35,-288.765C399.712,-280.283 405.147,-269.714 410.041,-260.197" fill="none" stroke="black"/>
<polygon fill="black" points="413.235,-261.641 414.696,-251.147 407.01,-258.439 413.235,-261.641" stroke="black"/>
</g>

<g class="node" id="node3"><title>6</title>
<ellipse cx="207" cy="-234" fill="#7fdbff" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="207" y="-229.8">6</text>
</g>

<g class="node" id="node32"><title>2</title>
<ellipse cx="423" cy="-162" fill="pink" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="423" y="-157.8">2</text>
</g>

<g class="edge" id="edge41"><title>6-&gt;2</title>
<path d="M230.941,-225.241C269.562,-212.725 345.715,-188.046 389.637,-173.812" fill="none" stroke="black"/>
<polygon fill="black" points="390.847,-177.099 399.281,-170.687 388.689,-170.44 390.847,-177.099" stroke="black"/>
</g>

<g class="node" id="node4"><title>root</title>
<ellipse cx="567" cy="-18" fill="#2ecc40" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="567" y="-13.8">root</text>
</g>

<g class="edge" id="edge7"><title>root-&gt;0</title>
<path d="M572.879,-35.9562C573.714,-43.8272 573.948,-53.3739 573.583,-62.1869" fill="none" stroke="black"/>
<polygon fill="black" points="570.074,-62.1835 572.84,-72.411 577.056,-62.6911 570.074,-62.1835" stroke="black"/>
</g>

<g class="node" id="node5"><title>24</title>
<ellipse cx="459" cy="-378" fill="#7fdbff" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="459" y="-373.8">24</text>
</g>

<g class="node" id="node30"><title>11</title>
<ellipse cx="459" cy="-306" fill="pink" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="459" y="-301.8">11</text>
</g>

<g class="edge" id="edge32"><title>24-&gt;11</title>
<path d="M459,-359.697C459,-351.983 459,-342.712 459,-334.112" fill="none" stroke="black"/>
<polygon fill="black" points="462.5,-334.104 459,-324.104 455.5,-334.104 462.5,-334.104" stroke="black"/>
</g>

<g class="node" id="node6"><title>3</title>
<ellipse cx="711" cy="-234" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="711" y="-229.8">3</text>
</g>

<g class="edge" id="edge4"><title>3-&gt;1</title>
<path d="M711,-215.697C711,-207.983 711,-198.712 711,-190.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="714.5,-190.104 711,-180.104 707.5,-190.104 714.5,-190.104" stroke="lightgrey"/>
</g>

<g class="node" id="node7"><title>4</title>
<ellipse cx="927" cy="-234" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="927" y="-229.8">4</text>
</g>

<g class="edge" id="edge18"><title>4-&gt;1</title>
<path d="M903.059,-225.241C864.438,-212.725 788.285,-188.046 744.363,-173.812" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="745.311,-170.44 734.719,-170.687 743.153,-177.099 745.311,-170.44" stroke="lightgrey"/>
</g>

<g class="node" id="node8"><title>7</title>
<ellipse cx="675" cy="-306" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="675" y="-301.8">7</text>
</g>

<g class="edge" id="edge3"><title>7-&gt;3</title>
<path d="M683.35,-288.765C687.712,-280.283 693.147,-269.714 698.041,-260.197" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="701.235,-261.641 702.696,-251.147 695.01,-258.439 701.235,-261.641" stroke="lightgrey"/>
</g>

<g class="node" id="node9"><title>8</title>
<ellipse cx="747" cy="-306" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="747" y="-301.8">8</text>
</g>

<g class="edge" id="edge12"><title>8-&gt;3</title>
<path d="M738.65,-288.765C734.288,-280.283 728.853,-269.714 723.959,-260.197" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="726.99,-258.439 719.304,-251.147 720.765,-261.641 726.99,-258.439" stroke="lightgrey"/>
</g>

<g class="node" id="node10"><title>9</title>
<ellipse cx="927" cy="-306" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="927" y="-301.8">9</text>
</g>

<g class="edge" id="edge17"><title>9-&gt;4</title>
<path d="M927,-287.697C927,-279.983 927,-270.712 927,-262.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="930.5,-262.104 927,-252.104 923.5,-262.104 930.5,-262.104" stroke="lightgrey"/>
</g>

<g class="node" id="node11"><title>10</title>
<ellipse cx="1035" cy="-306" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1035" y="-301.8">10</text>
</g>

<g class="edge" id="edge23"><title>10-&gt;4</title>
<path d="M1016.19,-292.807C998.998,-281.665 973.382,-265.062 954.007,-252.504" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="955.892,-249.555 945.597,-247.053 952.084,-255.429 955.892,-249.555" stroke="lightgrey"/>
</g>

<g class="node" id="node12"><title>13</title>
<ellipse cx="99" cy="-306" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="99" y="-301.8">13</text>
</g>

<g class="edge" id="edge40"><title>13-&gt;6</title>
<path d="M117.812,-292.807C135.002,-281.665 160.618,-265.062 179.993,-252.504" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="181.916,-255.429 188.403,-247.053 178.108,-249.555 181.916,-255.429" stroke="lightgrey"/>
</g>

<g class="node" id="node13"><title>14</title>
<ellipse cx="207" cy="-306" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="207" y="-301.8">14</text>
</g>

<g class="edge" id="edge46"><title>14-&gt;6</title>
<path d="M207,-287.697C207,-279.983 207,-270.712 207,-262.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="210.5,-262.104 207,-252.104 203.5,-262.104 210.5,-262.104" stroke="lightgrey"/>
</g>

<g class="node" id="node14"><title>15</title>
<ellipse cx="603" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="603" y="-373.8">15</text>
</g>

<g class="edge" id="edge2"><title>15-&gt;7</title>
<path d="M617.57,-362.834C627.75,-352.938 641.524,-339.546 653.031,-328.359" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="655.474,-330.865 660.204,-321.385 650.595,-325.846 655.474,-330.865" stroke="lightgrey"/>
</g>

<g class="node" id="node15"><title>16</title>
<ellipse cx="675" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="675" y="-373.8">16</text>
</g>

<g class="edge" id="edge9"><title>16-&gt;7</title>
<path d="M675,-359.697C675,-351.983 675,-342.712 675,-334.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="678.5,-334.104 675,-324.104 671.5,-334.104 678.5,-334.104" stroke="lightgrey"/>
</g>

<g class="node" id="node16"><title>17</title>
<ellipse cx="747" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="747" y="-373.8">17</text>
</g>

<g class="edge" id="edge11"><title>17-&gt;8</title>
<path d="M747,-359.697C747,-351.983 747,-342.712 747,-334.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="750.5,-334.104 747,-324.104 743.5,-334.104 750.5,-334.104" stroke="lightgrey"/>
</g>

<g class="node" id="node17"><title>18</title>
<ellipse cx="819" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="819" y="-373.8">18</text>
</g>

<g class="edge" id="edge14"><title>18-&gt;8</title>
<path d="M804.43,-362.834C794.25,-352.938 780.476,-339.546 768.969,-328.359" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="771.405,-325.846 761.796,-321.385 766.526,-330.865 771.405,-325.846" stroke="lightgrey"/>
</g>

<g class="node" id="node18"><title>19</title>
<ellipse cx="891" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="891" y="-373.8">19</text>
</g>

<g class="edge" id="edge16"><title>19-&gt;9</title>
<path d="M899.35,-360.765C903.712,-352.283 909.147,-341.714 914.041,-332.197" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="917.235,-333.641 918.696,-323.147 911.01,-330.439 917.235,-333.641" stroke="lightgrey"/>
</g>

<g class="node" id="node19"><title>20</title>
<ellipse cx="963" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="963" y="-373.8">20</text>
</g>

<g class="edge" id="edge20"><title>20-&gt;9</title>
<path d="M954.65,-360.765C950.288,-352.283 944.853,-341.714 939.959,-332.197" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="942.99,-330.439 935.304,-323.147 936.765,-333.641 942.99,-330.439" stroke="lightgrey"/>
</g>

<g class="node" id="node20"><title>21</title>
<ellipse cx="1035" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1035" y="-373.8">21</text>
</g>

<g class="edge" id="edge22"><title>21-&gt;10</title>
<path d="M1035,-359.697C1035,-351.983 1035,-342.712 1035,-334.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="1038.5,-334.104 1035,-324.104 1031.5,-334.104 1038.5,-334.104" stroke="lightgrey"/>
</g>

<g class="node" id="node21"><title>22</title>
<ellipse cx="1107" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1107" y="-373.8">22</text>
</g>

<g class="edge" id="edge25"><title>22-&gt;10</title>
<path d="M1092.43,-362.834C1082.25,-352.938 1068.48,-339.546 1056.97,-328.359" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="1059.41,-325.846 1049.8,-321.385 1054.53,-330.865 1059.41,-325.846" stroke="lightgrey"/>
</g>

<g class="node" id="node22"><title>25</title>
<ellipse cx="315" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="315" y="-373.8">25</text>
</g>

<g class="edge" id="edge34"><title>25-&gt;12</title>
<path d="M329.57,-362.834C339.75,-352.938 353.524,-339.546 365.031,-328.359" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="367.474,-330.865 372.204,-321.385 362.595,-325.846 367.474,-330.865" stroke="lightgrey"/>
</g>

<g class="node" id="node23"><title>26</title>
<ellipse cx="387" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="387" y="-373.8">26</text>
</g>

<g class="edge" id="edge37"><title>26-&gt;12</title>
<path d="M387,-359.697C387,-351.983 387,-342.712 387,-334.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="390.5,-334.104 387,-324.104 383.5,-334.104 390.5,-334.104" stroke="lightgrey"/>
</g>

<g class="node" id="node24"><title>27</title>
<ellipse cx="27" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="27" y="-373.8">27</text>
</g>

<g class="edge" id="edge39"><title>27-&gt;13</title>
<path d="M41.5703,-362.834C51.7499,-352.938 65.5239,-339.546 77.0306,-328.359" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="79.4741,-330.865 84.2043,-321.385 74.5945,-325.846 79.4741,-330.865" stroke="lightgrey"/>
</g>

<g class="node" id="node25"><title>28</title>
<ellipse cx="99" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="99" y="-373.8">28</text>
</g>

<g class="edge" id="edge43"><title>28-&gt;13</title>
<path d="M99,-359.697C99,-351.983 99,-342.712 99,-334.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="102.5,-334.104 99,-324.104 95.5001,-334.104 102.5,-334.104" stroke="lightgrey"/>
</g>

<g class="node" id="node26"><title>29</title>
<ellipse cx="171" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="171" y="-373.8">29</text>
</g>

<g class="edge" id="edge45"><title>29-&gt;14</title>
<path d="M179.35,-360.765C183.712,-352.283 189.147,-341.714 194.041,-332.197" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="197.235,-333.641 198.696,-323.147 191.01,-330.439 197.235,-333.641" stroke="lightgrey"/>
</g>

<g class="node" id="node27"><title>30</title>
<ellipse cx="243" cy="-378" fill="none" rx="27" ry="18" stroke="lightgrey"/>
<text fill="lightgrey" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="243" y="-373.8">30</text>
</g>

<g class="edge" id="edge48"><title>30-&gt;14</title>
<path d="M234.65,-360.765C230.288,-352.283 224.853,-341.714 219.959,-332.197" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="222.99,-330.439 215.304,-323.147 216.765,-333.641 222.99,-330.439" stroke="lightgrey"/>
</g>

<g class="node" id="node28"><title>B9</title>
<ellipse cx="531" cy="-450" fill="#ff4136" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="531" y="-445.8">B9</text>
</g>

<g class="node" id="node29"><title>23</title>
<ellipse cx="531" cy="-378" fill="pink" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="531" y="-373.8">23</text>
</g>

<g class="edge" id="edge26"><title>B9-&gt;23</title>
<path d="M531,-431.697C531,-423.983 531,-414.712 531,-406.112" fill="none" stroke="black"/>
<polygon fill="black" points="534.5,-406.104 531,-396.104 527.5,-406.104 534.5,-406.104" stroke="black"/>
</g>

<g class="edge" id="edge27"><title>23-&gt;11</title>
<path d="M516.43,-362.834C506.25,-352.938 492.476,-339.546 480.969,-328.359" fill="none" stroke="black"/>
<polygon fill="black" points="483.405,-325.846 473.796,-321.385 478.526,-330.865 483.405,-325.846" stroke="black"/>
</g>

<g class="edge" id="edge28"><title>11-&gt;5</title>
<path d="M450.65,-288.765C446.288,-280.283 440.853,-269.714 435.959,-260.197" fill="none" stroke="black"/>
<polygon fill="black" points="438.99,-258.439 431.304,-251.147 432.765,-261.641 438.99,-258.439" stroke="black"/>
</g>

<g class="edge" id="edge29"><title>5-&gt;2</title>
<path d="M423,-215.697C423,-207.983 423,-198.712 423,-190.112" fill="none" stroke="black"/>
<polygon fill="black" points="426.5,-190.104 423,-180.104 419.5,-190.104 426.5,-190.104" stroke="black"/>
</g>

<g class="edge" id="edge30"><title>2-&gt;0</title>
<path d="M444.248,-150.671C468.602,-138.832 508.719,-119.331 536.428,-105.862" fill="none" stroke="black"/>
<polygon fill="black" points="538.202,-108.891 545.665,-101.371 535.141,-102.595 538.202,-108.891" stroke="black"/>
</g>

<g class="edge" id="edge6"><title>0-&gt;root</title>
<path d="M561.16,-72.411C560.297,-64.507 560.048,-54.8518 560.412,-45.9352" fill="none" stroke="black"/>
<polygon fill="black" points="563.903,-46.1791 561.121,-35.9562 556.921,-45.6831 563.903,-46.1791" stroke="black"/>
</g>

<g class="node" id="node34"><title>B1</title>
<ellipse cx="603" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="603" y="-445.8">B1</text>
</g>

<g class="edge" id="edge1"><title>B1-&gt;15</title>
<path d="M603,-431.697C603,-423.983 603,-414.712 603,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="606.5,-406.104 603,-396.104 599.5,-406.104 606.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node35"><title>B2</title>
<ellipse cx="675" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="675" y="-445.8">B2</text>
</g>

<g class="edge" id="edge8"><title>B2-&gt;16</title>
<path d="M675,-431.697C675,-423.983 675,-414.712 675,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="678.5,-406.104 675,-396.104 671.5,-406.104 678.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node36"><title>B3</title>
<ellipse cx="747" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="747" y="-445.8">B3</text>
</g>

<g class="edge" id="edge10"><title>B3-&gt;17</title>
<path d="M747,-431.697C747,-423.983 747,-414.712 747,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="750.5,-406.104 747,-396.104 743.5,-406.104 750.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node37"><title>B4</title>
<ellipse cx="819" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="819" y="-445.8">B4</text>
</g>

<g class="edge" id="edge13"><title>B4-&gt;18</title>
<path d="M819,-431.697C819,-423.983 819,-414.712 819,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="822.5,-406.104 819,-396.104 815.5,-406.104 822.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node38"><title>B5</title>
<ellipse cx="891" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="891" y="-445.8">B5</text>
</g>

<g class="edge" id="edge15"><title>B5-&gt;19</title>
<path d="M891,-431.697C891,-423.983 891,-414.712 891,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="894.5,-406.104 891,-396.104 887.5,-406.104 894.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node39"><title>B6</title>
<ellipse cx="963" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="963" y="-445.8">B6</text>
</g>

<g class="edge" id="edge19"><title>B6-&gt;20</title>
<path d="M963,-431.697C963,-423.983 963,-414.712 963,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="966.5,-406.104 963,-396.104 959.5,-406.104 966.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node40"><title>B7</title>
<ellipse cx="1035" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1035" y="-445.8">B7</text>
</g>

<g class="edge" id="edge21"><title>B7-&gt;21</title>
<path d="M1035,-431.697C1035,-423.983 1035,-414.712 1035,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="1038.5,-406.104 1035,-396.104 1031.5,-406.104 1038.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node41"><title>B8</title>
<ellipse cx="1107" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="1107" y="-445.8">B8</text>
</g>

<g class="edge" id="edge24"><title>B8-&gt;22</title>
<path d="M1107,-431.697C1107,-423.983 1107,-414.712 1107,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="1110.5,-406.104 1107,-396.104 1103.5,-406.104 1110.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node42"><title>B10</title>
<ellipse cx="459" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="459" y="-445.8">B10</text>
</g>

<g class="edge" id="edge31"><title>B10-&gt;24</title>
<path d="M459,-431.697C459,-423.983 459,-414.712 459,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="462.5,-406.104 459,-396.104 455.5,-406.104 462.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node43"><title>B11</title>
<ellipse cx="315" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="315" y="-445.8">B11</text>
</g>

<g class="edge" id="edge33"><title>B11-&gt;25</title>
<path d="M315,-431.697C315,-423.983 315,-414.712 315,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="318.5,-406.104 315,-396.104 311.5,-406.104 318.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node44"><title>B12</title>
<ellipse cx="387" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="387" y="-445.8">B12</text>
</g>

<g class="edge" id="edge36"><title>B12-&gt;26</title>
<path d="M387,-431.697C387,-423.983 387,-414.712 387,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="390.5,-406.104 387,-396.104 383.5,-406.104 390.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node45"><title>B13</title>
<ellipse cx="27" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="27" y="-445.8">B13</text>
</g>

<g class="edge" id="edge38"><title>B13-&gt;27</title>
<path d="M27,-431.697C27,-423.983 27,-414.712 27,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="30.5001,-406.104 27,-396.104 23.5001,-406.104 30.5001,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node46"><title>B14</title>
<ellipse cx="99" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="99" y="-445.8">B14</text>
</g>

<g class="edge" id="edge42"><title>B14-&gt;28</title>
<path d="M99,-431.697C99,-423.983 99,-414.712 99,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="102.5,-406.104 99,-396.104 95.5001,-406.104 102.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node47"><title>B15</title>
<ellipse cx="171" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="171" y="-445.8">B15</text>
</g>

<g class="edge" id="edge44"><title>B15-&gt;29</title>
<path d="M171,-431.697C171,-423.983 171,-414.712 171,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="174.5,-406.104 171,-396.104 167.5,-406.104 174.5,-406.104" stroke="lightgrey"/>
</g>

<g class="node" id="node48"><title>B16</title>
<ellipse cx="243" cy="-450" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="243" y="-445.8">B16</text>
</g>

<g class="edge" id="edge47"><title>B16-&gt;30</title>
<path d="M243,-431.697C243,-423.983 243,-414.712 243,-406.112" fill="none" stroke="lightgrey"/>
<polygon fill="lightgrey" points="246.5,-406.104 243,-396.104 239.5,-406.104 246.5,-406.104" stroke="lightgrey"/>
</g>
</g>
</svg>
<p>The efficiency comes from peers not needing to know so much. In fact, there was
quite a lot we didn’t need to know (all the grey stuff in the diagram). The
hashes that make up the tree for the blocks we don’t yet have can remain
unknown because those nodes in the tree are covered by the blue "uncle" nodes.</p>
<p>Cool.</p>
</div>
<div class="section" id="gits-dag">
<h1>Git’s DAG</h1>
<p>So we briefly covered the application of a Merkle tree in the context of
verifying untrusted blocks of files in peer-to-peer systems, but how does that
apply when we’re talking about Git?</p>
<p>Reading Tommi Virtanen’s great article <a class="reference external" href="http://eagain.net/articles/git-for-computer-scientists/">Git for computer scientists</a> is a good
place to start seeing how Git’s DAG works. Taking (some) inspiration from
<a class="reference external" href="https://github.com/esc/git-big-picture">git-big-picture</a> I whipped up <a class="reference external" href="https://github.com/bmcorser/git-little-picture">a script</a> to examine Git’s DAG. We can see
how deduplication is handled by addressing content rather than files. Follow
along with my experiment:</p>
<div class="highlight"><pre><span class="nv">$ </span>git init
<span class="nv">$ </span>mkdir A
<span class="nv">$ </span>touch A/a A/b
<span class="nv">$ </span>touch B
<span class="nv">$ </span>tree .
.
├── A
│   ├── a
│   └── b
└── B

<span class="m">1</span> directory, <span class="m">3</span> files
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s1">'init'</span>
<span class="nv">$ </span>git rev-parse HEAD <span class="p">|</span> cut -c 1-7
ee8285e
</pre></div>
<p>Ok, so that’s the simplest repo known to man and we have the revision ID of
<tt class="docutils literal">HEAD</tt>. Let’s look at the what’s going on under the hood.</p>
<object class="full" data="/assets/images/ee8285e.svg" type="image/svg+xml">
/assets/images/ee8285e.svg</object>
<p>We can see the directory <tt class="docutils literal">A</tt> (or tree object <tt class="docutils literal">296e560</tt>) and the files
<tt class="docutils literal">B</tt>, <tt class="docutils literal">a</tt> and <tt class="docutils literal">b</tt> we created.  Notice that all the files reference that
same blob object <tt class="docutils literal">e69de29</tt>, that’s because they are all empty files (and
therefore have the same content, nothing). If we alter file <tt class="docutils literal">a</tt> to not be
empty (and therefore have different content) like this:</p>
<div class="highlight"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'hello'</span> &gt; A/a
<span class="nv">$ </span>git add A/a
<span class="nv">$ </span>git commit -m <span class="s1">'altered a'</span>
<span class="nv">$ </span>git rev-parse HEAD <span class="p">|</span> cut -c 1-7
437816a
</pre></div>
<p>Not only do we get a new commit ID and commit-tree ID (<tt class="docutils literal">e468afd</tt>), but we
also see the underlying DAG change:</p>
<object class="full" data="/assets/images/437816a.svg" type="image/svg+xml">
/assets/images/437816a.svg</object>
<p>Both files <tt class="docutils literal">b</tt> and <tt class="docutils literal">B</tt> :smile: still share a blob, but <tt class="docutils literal">a</tt> now has a blob
of its very own. This also demonstrates that in Git’s model, blob objects
correspond to one-to-one with files (sans directory location) which works fine
if you only want to deduplicate files that have <em>exactly</em> the same content, but
deduplication could be more aggressive if files were split into blocks and
deduplicated at block-level instead of file-level.</p>





<svg class="dot-graph" viewbox="0.00 0.00 350.00 116.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 112)">
<title>G</title>
<polygon fill="white" points="-4,4 -4,-112 346,-112 346,4 -4,4" stroke="none"/>

<g class="node" id="node1"><title>B1</title>
<ellipse cx="99" cy="-90" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="99" y="-85.8">B1</text>
</g>

<g class="node" id="node6"><title>A</title>
<ellipse cx="99" cy="-18" fill="#7fdbff" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="99" y="-13.8">A</text>
</g>

<g class="edge" id="edge1"><title>B1-&gt;A</title>
<path d="M99,-71.6966C99,-63.9827 99,-54.7125 99,-46.1124" fill="none" stroke="black"/>
<polygon fill="black" points="102.5,-46.1043 99,-36.1043 95.5001,-46.1044 102.5,-46.1043" stroke="black"/>
</g>

<g class="node" id="node7"><title>B</title>
<ellipse cx="207" cy="-18" fill="#7fdbff" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="207" y="-13.8">B</text>
</g>

<g class="edge" id="edge5"><title>B1-&gt;B</title>
<path d="M117.812,-76.8069C135.002,-65.6653 160.618,-49.0622 179.993,-36.5043" fill="none" stroke="black"/>
<polygon fill="black" points="181.916,-39.4294 188.403,-31.0533 178.108,-33.5553 181.916,-39.4294" stroke="black"/>
</g>

<g class="node" id="node2"><title>B2</title>
<ellipse cx="171" cy="-90" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="171" y="-85.8">B2</text>
</g>

<g class="edge" id="edge2"><title>B2-&gt;A</title>
<path d="M156.43,-74.8345C146.25,-64.9376 132.476,-51.5462 120.969,-40.3591" fill="none" stroke="black"/>
<polygon fill="black" points="123.405,-37.8461 113.796,-33.3847 118.526,-42.865 123.405,-37.8461" stroke="black"/>
</g>

<g class="edge" id="edge6"><title>B2-&gt;B</title>
<path d="M179.35,-72.7646C183.712,-64.2831 189.147,-53.7144 194.041,-44.1974" fill="none" stroke="black"/>
<polygon fill="black" points="197.235,-45.6409 198.696,-35.1473 191.01,-42.4395 197.235,-45.6409" stroke="black"/>
</g>

<g class="node" id="node3"><title>B3</title>
<ellipse cx="243" cy="-90" fill="#ffdc00" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="243" y="-85.8">B3</text>
</g>

<g class="edge" id="edge3"><title>B3-&gt;A</title>
<path d="M221.752,-78.6713C197.398,-66.8324 157.281,-47.3312 129.572,-33.8615" fill="none" stroke="black"/>
<polygon fill="black" points="130.859,-30.5953 120.335,-29.3711 127.798,-36.8909 130.859,-30.5953" stroke="black"/>
</g>

<g class="edge" id="edge7"><title>B3-&gt;B</title>
<path d="M234.65,-72.7646C230.288,-64.2831 224.853,-53.7144 219.959,-44.1974" fill="none" stroke="black"/>
<polygon fill="black" points="222.99,-42.4395 215.304,-35.1473 216.765,-45.6409 222.99,-42.4395" stroke="black"/>
</g>

<g class="node" id="node4"><title>B4</title>
<ellipse cx="27" cy="-90" fill="pink" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="27" y="-85.8">B4</text>
</g>

<g class="edge" id="edge4"><title>B4-&gt;A</title>
<path d="M41.5703,-74.8345C51.7499,-64.9376 65.5239,-51.5462 77.0306,-40.3591" fill="none" stroke="black"/>
<polygon fill="black" points="79.4741,-42.865 84.2043,-33.3847 74.5945,-37.8461 79.4741,-42.865" stroke="black"/>
</g>

<g class="node" id="node5"><title>B5</title>
<ellipse cx="315" cy="-90" fill="pink" rx="27" ry="18" stroke="black"/>
<text font-family="Times,serif" font-size="14.00" text-anchor="middle" x="315" y="-85.8">B5</text>
</g>

<g class="edge" id="edge8"><title>B5-&gt;B</title>
<path d="M296.188,-76.8069C278.998,-65.6653 253.382,-49.0622 234.007,-36.5043" fill="none" stroke="black"/>
<polygon fill="black" points="235.892,-33.5553 225.597,-31.0533 232.084,-39.4294 235.892,-33.5553" stroke="black"/>
</g>
</g>
</svg>
<p>Files <tt class="docutils literal">A</tt> and <tt class="docutils literal">B</tt> share most blocks (yellow), so blocks 1-3 are used by
both, only blocks 4 and 5 (pink) are unique to the individual files.</p>
<p>That’s enough colourful graphs for now. Get back to work.</p>
</div>
</div>

  </div></body></html></body>